<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico" sizes="any">
    <title>ULTIMATE WHITELIST BYPASS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #30363d;
        }
        
        h1 {
            color: #58a6ff;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .version {
            color: #8b949e;
            font-size: 1.2rem;
        }
        
        .sub_version {
            color: #8b949e;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .credits {
            color: #8b949e;
            font-size: 1rem;
        }
        
        .panel {
            background-color: #161b22;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #30363d;
        }
        
        .panel-title {
            color: #58a6ff;
            font-size: 1.4rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .panel-title i {
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #c9d1d9;
            font-weight: 500;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #58a6ff;
        }
        
        .hint {
            font-size: 0.9rem;
            color: #8b949e;
            margin-top: 5px;
        }
        
        .hint.ai-warning {
            color: #f85149;
            font-weight: 500;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            padding: 14px 24px;
            background-color: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            background-color: #2ea043;
        }
        
        button.secondary {
            background-color: #21262d;
        }
        
        button.secondary:hover {
            background-color: #30363d;
        }
        
        button:disabled {
            background-color: #30363d;
            cursor: not-allowed;
        }
        
        .status-panel {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .status-message {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #c9d1d9;
        }
        
        .status-details {
            font-size: 1rem;
            color: #8b949e;
        }
        
        .status-progress {
            height: 6px;
            background-color: #0d1117;
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #238636;
            width: 0%;
            transition: width 0.5s;
        }
        
        .results-panel {
            display: none;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .config-count {
            background-color: #238636;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .configs-container {
            background-color: #0d1117;
            border-radius: 6px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #30363d;
        }
        
        .config-item {
            padding: 12px;
            border-bottom: 1px solid #30363d;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            position: relative;
        }
        
        .config-item:last-child {
            border-bottom: none;
        }
        
        .config-status {
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 3px;
        }
        
        .status-guaranteed {
            background-color: rgba(218, 170, 15, 0.2);
            color: #daaa0f;
            font-weight: bold;
        }
        
        .status-ai {
            background-color: rgba(188, 84, 255, 0.2);
            color: #bc54ff;
            font-weight: bold;
        }
        
        .status-ws {
            background-color: rgba(56, 139, 253, 0.2);
            color: #58a6ff;
        }
        
        .status-dns {
            background-color: rgba(63, 185, 80, 0.2);
            color: #3fb950;
        }
        
        .actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .success {
            color: #3fb950;
        }
        
        .error {
            color: #f85149;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #30363d;
            border-top-color: #58a6ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            display: inline-block;
            margin-right: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #8b949e;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #30363d;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ† ULTIMATE WHITELIST BYPASS üë®‚Äçüíª</h1>
            <div class="version">‚úì –í–µ—Ä—Å–∏—è: V1.5</div>
            <div class="sub_version">–î–æ–±–∞–≤–ª–µ–Ω AI-–ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤</div>
            <div class="credits">‚Ä¢ By RYZz and t.me/catlergememe community</div>
        </header>
        
        <main>
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-cogs"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞
                </div>
                
                <div class="form-group">
                    <label for="outputPath">–ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤</label>
                    <input type="text" id="outputPath" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ">
                    <div class="hint">–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫ "UWB_script_configs.txt" –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–∞–ø–∫–µ</div>
                </div>
                
                <div class="form-group">
                    <label for="keyword">–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</label>
                    <input type="text" id="keyword" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤">
                    <div class="hint">–ë—É–¥—É—Ç –≤—ã–±—Ä–∞–Ω—ã —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ</div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="enableAISearch"> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI-–ø–æ–∏—Å–∫ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π)
                    </label>
                    <div class="hint ai-warning">‚ö†Ô∏è AI-–ø–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM7 API, —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏ —Ç—Ä–µ–±—É–µ—Ç –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞</div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="checkConfigs" checked> –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ (DNS + WebSocket)
                    </label>
                    <div class="hint">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥–æ–≤</div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="fastMode" checked> –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º
                    </label>
                    <div class="hint">–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã</div>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="prioritizeGuaranteed" checked> –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
                    </label>
                    <div class="hint">–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –Ω–∞—à–µ–≥–æ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞</div>
                </div>
                
                <div class="buttons">
                    <button id="startBtn">
                        <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤
                    </button>
                    <button id="resetBtn" class="secondary">
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <div class="panel status-panel">
                <div class="panel-title">
                    <i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                </div>
                
                <div class="status-message" id="statusMessage">–ì–æ—Ç–æ–≤ –∫ –ø–æ–∏—Å–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤...</div>
                <div class="status-details" id="statusDetails">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤" –¥–ª—è –∑–∞–ø—É—Å–∫–∞</div>
                
                <div class="status-progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>
            
            <div class="panel results-panel" id="resultsPanel">
                <div class="results-header">
                    <div class="panel-title">
                        <i class="fas fa-list"></i> –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
                    </div>
                    <div class="config-count" id="configCount">0 –∫–æ–Ω—Ñ–∏–≥–æ–≤</div>
                </div>
                
                <div class="configs-container" id="configsContainer">
                    <!-- –ö–æ–Ω—Ñ–∏–≥–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
                
                <div class="actions">
                    <button id="downloadBtn" class="secondary">
                        <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏
                    </button>
                </div>
            </div>
        </main>
        
        <footer>
            <p>‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥–∏ —Ç–æ–ª—å–∫–æ –≤ –∑–∞–∫–æ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö. –ê–≤—Ç–æ—Ä—ã –Ω–µ –Ω–µ—Å—É—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è.</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: #58a6ff;">
                <i class="fas fa-star"></i> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
                <i class="fas fa-brain" style="margin-left: 15px;"></i> AI-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ LLM7 API
            </p>
        </footer>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–°–¢–û–ß–ù–ò–ö–û–í ===
        // –í–ê–®–ê –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –†–ê–ë–û–ß–ê–Ø –ü–û–î–ü–ò–°–ö–ê (–≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π)
        const GUARANTEED_SUBSCRIPTION = "https://raw.githubusercontent.com/RYZgames31/UWB/refs/heads/main/wcfg";
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
        const ADDITIONAL_SUBSCRIPTIONS = [
            "https://raw.githubusercontent.com/AvenCores/goida-vpn-configs/refs/heads/main/githubmirror/26.txt",
            "https://raw.githubusercontent.com/roosterkid/openproxylist/main/V2RAY_RAW.txt",
            "https://raw.githubusercontent.com/zieng2/wl/main/vless.txt",
            "https://raw.githubusercontent.com/igareck/vpn-configs-for-russia/refs/heads/main/Vless-Reality-White-Lists-Rus-Mobile.txt",
            "https://raw.githubusercontent.com/LowiKLive/BypassWhitelistRu/refs/heads/main/WhiteList-Bypass_Ru.txt",
            "https://raw.githubusercontent.com/zieng2/wl/main/vless_universal.txt"
        ];
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤–∞—è)
        function getAllSubscriptions(prioritizeGuaranteed = true) {
            if (prioritizeGuaranteed) {
                return [GUARANTEED_SUBSCRIPTION, ...ADDITIONAL_SUBSCRIPTIONS];
            }
            return [...ADDITIONAL_SUBSCRIPTIONS, GUARANTEED_SUBSCRIPTION];
        }

        // === –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const outputPathInput = document.getElementById('outputPath');
        const keywordInput = document.getElementById('keyword');
        const enableAISearchCheckbox = document.getElementById('enableAISearch');
        const checkConfigsCheckbox = document.getElementById('checkConfigs');
        const fastModeCheckbox = document.getElementById('fastMode');
        const prioritizeGuaranteedCheckbox = document.getElementById('prioritizeGuaranteed');
        const statusMessage = document.getElementById('statusMessage');
        const statusDetails = document.getElementById('statusDetails');
        const progressBar = document.getElementById('progressBar');
        const resultsPanel = document.getElementById('resultsPanel');
        const configsContainer = document.getElementById('configsContainer');
        const configCount = document.getElementById('configCount');

        let foundConfigs = [];
        let totalConfigs = 0;
        let configsWithoutDuplicates = 0;
        let isProcessing = false;
        let aiSearchEnabled = false;

        // === AI-–ü–û–ò–°–ö –§–£–ù–ö–¶–ò–ò ===
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—ã—Ä—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –ø–æ–¥–ø–∏—Å–æ–∫
        async function fetchRawConfigsFromAllSources() {
            const subscriptions = getAllSubscriptions(prioritizeGuaranteedCheckbox.checked);
            let allRawTexts = [];
            
            for (let i = 0; i < subscriptions.length; i++) {
                const url = subscriptions[i];
                try {
                    updateStatus('üì• –°–±–æ—Ä —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AI', `–ò—Å—Ç–æ—á–Ω–∏–∫ ${i+1}/${subscriptions.length}`, 10 + (i/subscriptions.length)*20);
                    
                    const response = await fetch(url, { 
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        const text = await response.text();
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç —Å –ø–æ–º–µ—Ç–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                        allRawTexts.push(`=== –ò–°–¢–û–ß–ù–ò–ö: ${url} ===\n${text.substring(0, 50000)}`); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                    }
                } catch (error) {
                    console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ ${url}:`, error);
                }
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            return allRawTexts.join('\n\n');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è AI-–ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ —á–µ—Ä–µ–∑ LLM7 API (–° –û–ë–ù–û–í–õ–ï–ù–ù–´–ú –ü–†–û–ú–ü–¢–û–ú)
        async function searchConfigsWithAI(keyword, rawConfigsText) {
            if (!keyword || keyword.trim() === '') {
                throw new Error('–î–ª—è AI-–ø–æ–∏—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ');
            }
            
            updateStatus('üß† AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏', '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ LLM7 API...', 50);
            
            // –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ü–†–û–ú–ü–¢ - –ë–û–õ–ï–ï –°–¢–†–û–ì–ò–ô –ò –ö–û–ù–ö–†–ï–¢–ù–´–ô
            const prompt = `
–¢–´ ‚Äî –°–ò–°–¢–ï–ú–ê –ü–û–ò–°–ö–ê VPN-–ö–û–ù–§–ò–ì–û–í. –¢–≤–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–π—Ç–∏ –∏ –∏–∑–≤–ª–µ—á—å –∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ü–û–õ–ù–´–ï –∏ –†–ê–ë–û–ß–ò–ï –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏.

–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞: "${keyword}".

–ß–ï–¢–ö–ò–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò, –ö–û–¢–û–†–´–ú –¢–´ –î–û–õ–ñ–ï–ù –°–õ–ï–î–û–í–ê–¢–¨:

1.  **–ß—Ç–æ –∏—Å–∫–∞—Ç—å**: –ù–∞–π–¥–∏ –≤—Å–µ –ø–æ–ª–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (protocol://...).
    *   –í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –∏—â–∏ –∫–æ–Ω—Ñ–∏–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    *   –¢–∞–∫–∂–µ –∏—â–∏ –∫–æ–Ω—Ñ–∏–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ (—Å–æ–¥–µ—Ä–∂–∞—Ç —Ä—É—Å—Å–∫–∏–µ SNI, –¥–æ–º–µ–Ω—ã —Ç–∏–ø–∞ vk.com, yandex.ru, mail.ru, —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –†–æ—Å—Å–∏–∏).

2.  **–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å**: –í–æ–∑–≤—Ä–∞—â–∞–π **–¢–û–õ–¨–ö–û –ü–û–õ–ù–´–ï –ò –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ï –°–°–´–õ–ö–ò**.
    *   **–ó–ê–ü–†–ï–©–ï–ù–û** —É–∫–æ—Ä–∞—á–∏–≤–∞—Ç—å, –æ–±—Ä–µ–∑–∞—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω—è—Ç—å —á–∞—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ (...).
    *   **–ó–ê–ü–†–ï–©–ï–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –æ–ø–∏—Å–∞–Ω–∏—è, –º–µ—Ç–∫–∏ (—Ç–∏–ø–∞ "VLESS-TCP-RLT"), IP-–∞–¥—Ä–µ—Å–∞ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
    *   –ö–∞–∂–¥–∞—è –Ω–∞–π–¥–µ–Ω–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–≤–µ–¥–µ–Ω–∞ —Å **–ù–ê–ß–ê–õ–ê** (vless://, vmess://, ss://, trojan://) –∏ –¥–æ —Å–∞–º–æ–≥–æ **–ö–û–ù–¶–ê** (–¥–æ —Å–∏–º–≤–æ–ª–∞ \`#\` –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏).
    *   –ö–∞–∂–¥–∞—è –ø–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.

3.  **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**: –¢–≤–æ–π –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º —Å—Å—ã–ª–æ–∫. –ù–∏–∫–∞–∫–æ–≥–æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è, –∑–∞–∫–ª—é—á–µ–Ω–∏—è, –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –≤—ã–≤–æ–¥–∞ (–∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –Ω—É–∂–µ–Ω):
vless://0ea84d1f-2687-467d-97dd-ed8d5e8f3f42@51.250.71.197:443?security=reality&encryption=none&pbk=96px9lCo9VgWb1Je0958ayYtcwyOAmpCBmbfK0O6jxI&headerType=none&fp=chrome&spx=%2F&type=tcp&flow=xtls-rprx-vision&sni=static.rutube.ru&sid=fade49d5#%F0%9F%87%B7%F0%9F%87%BA%20Moscow%20%5B*CIDR%20SNI%5D%20yandex
vless://3f214356-cfab-4056-9c06-7e2199fdf6e3@ru01-blh01.tcp-reset-club.net:443?security=reality&encryption=none&pbk=mLmBhbVFfNuo2eUgBh6r9-5Koz9mUCn3aSzlR6IejUg&headerType=none&fp=chrome&spx=%2F&type=tcp&flow=xtls-rprx-vision&sni=stats.vk-portal.net&sid=175d#%F0%9F%87%B7%F0%9F%87%BA%20Moscow%2010%20%7C%20%E2%9A%A1LTE%7C%D0%9C%D0%BE%D0%B1.%D0%B1%D0%B5%D0%BB%D1%8B%D0%B9%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%7Cvk
vless://e3ce253c-896c-416f-9a4a-33b1cb771e02@ru01-blh01.tcp-reset-club.net:443?security=reality&encryption=none&pbk=mLmBhbVFfNuo2eUgBh6r9-5Koz9mUCn3aSzlR6IejUg&headerType=none&fp=chrome&spx=%2F&type=tcp&flow=xtls-rprx-vision&sni=stats.vk-portal.net&sid=48720c#%F0%9F%87%B7%F0%9F%87%BA%20Moscow%209%20%7C%20%E2%9A%A1LTE%7C%D0%9C%D0%BE%D0%B1.%D0%B1%D0%B5%D0%BB%D1%8B%D0%B9%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA%7Cvk

–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:
${rawConfigsText.substring(0, 45000)}...
`;
            
            try {
                const response = await fetch('https://api.llm7.io/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer unused'
                    },
                    body: JSON.stringify({
                        model: "fast",
                        messages: [
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.1,
                        max_tokens: 4000
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ API: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const aiResponse = data.choices[0].message.content;
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ AI
                    const aiConfigs = extractConfigsFromAIResponse(aiResponse);
                    
                    updateStatus('‚úÖ AI –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω', `AI –Ω–∞—à–µ–ª ${aiConfigs.length} –∫–æ–Ω—Ñ–∏–≥–æ–≤`, 70);
                    return aiConfigs;
                } else {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI');
                }
            } catch (error) {
                alert(error)
                alert(error.message)
                console.error('–û—à–∏–±–∫–∞ AI-–ø–æ–∏—Å–∫–∞:', error);
                throw new Error(`AI-–ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: ${error.message}`);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –æ—Ç–≤–µ—Ç–∞ AI
        function extractConfigsFromAIResponse(aiResponse) {
            const lines = aiResponse.split('\n');
            const configs = [];
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
            const configPatterns = [
                /vless:\/\/[^\s]+/gi,
                /vmess:\/\/[^\s]+/gi,
                /trojan:\/\/[^\s]+/gi,
                /ss:\/\/[^\s]+/gi
            ];
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—Ö–æ–∂–∞ –ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–∞ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
                if (trimmedLine && 
                   (trimmedLine.startsWith('vless://') || 
                    trimmedLine.startsWith('vmess://') ||
                    trimmedLine.startsWith('trojan://') ||
                    trimmedLine.startsWith('ss://'))) {
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ü–û–õ–ù–´–ô –∫–æ–Ω—Ñ–∏–≥, –∞ –Ω–µ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π
                    if (!trimmedLine.includes('...') && 
                        trimmedLine.includes('@') && 
                        (trimmedLine.includes('?') || trimmedLine.includes(':')) &&
                        trimmedLine.length > 50) { // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
                        configs.push(trimmedLine);
                    }
                }
                
                // –¢–∞–∫–∂–µ –∏—â–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫
                configPatterns.forEach(pattern => {
                    const matches = trimmedLine.match(pattern);
                    if (matches) {
                        matches.forEach(match => {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥, –∞ –Ω–µ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π
                            if (!match.includes('...') && 
                                match.includes('@') && 
                                (match.includes('?') || match.includes(':')) &&
                                match.length > 50 &&
                                !configs.includes(match)) {
                                configs.push(match);
                            }
                        });
                    }
                });
            });
            
            // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã
            return [...new Set(configs)];
        }

        // === –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è URL
        function decodeURLComponent(str) {
            try {
                return decodeURIComponent(str.replace(/\+/g, ' '));
            } catch (e) {
                return str;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, details = '', progress = 0) {
            statusMessage.textContent = message;
            statusDetails.textContent = details;
            progressBar.style.width = `${progress}%`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        function isValidConfig(config, keyword) {
            const decodedConfig = decodeURLComponent(config);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
            const hasRussianSites = 
                config.includes('vk.com') || decodedConfig.includes('vk.com') ||
                config.includes('userapi.com') || decodedConfig.includes('userapi.com') ||
                config.includes('mail.ru') || decodedConfig.includes('mail.ru') ||
                config.includes('yandex.net') || decodedConfig.includes('yandex.net') ||
                config.includes('yastatic.net') || decodedConfig.includes('yastatic.net') ||
                config.includes('yandex.ru') || decodedConfig.includes('yandex.ru') ||
                config.includes('ok.ru') || decodedConfig.includes('ok.ru') ||
                config.includes('ozone.ru') || decodedConfig.includes('ozone.ru') ||
                config.includes('rutube.ru') || decodedConfig.includes('rutube.ru');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
            const hasRussianIndicators = 
                config.includes('%F0%9F%87%B7%F0%9F%87%BA') || 
                decodedConfig.includes('üá∑üá∫') ||
                config.includes('RU') || decodedConfig.includes('RU') ||
                config.includes('Russia') || decodedConfig.includes('Russia') ||
                config.includes('–†–æ—Å—Å–∏—è') || decodedConfig.includes('–†–æ—Å—Å–∏—è') ||
                config.includes('Russian') || decodedConfig.includes('Russian');
            
            // –ò—Å–∫–ª—é—á–µ–Ω–∏—è
            const hasExcludedTerms = 
                decodedConfig.includes('–ú–æ—Å–∫–≤–∞') ||
                config.includes('#%5BSNI%3A') ||
                decodedConfig.includes('confegraigan') ||
                decodedConfig.includes('Global Connectivity Solutions Llp') ||
                decodedConfig.includes('Yandex.Cloud LLC') ||
                decodedConfig.includes('Hypercore Ltd') ||
                decodedConfig.includes('Cloud Network LLC');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
            const hasKeyword = keyword === '' || 
                decodedConfig.toLowerCase().includes(keyword.toLowerCase()) ||
                config.toLowerCase().includes(keyword.toLowerCase());
            
            return hasRussianSites && hasRussianIndicators && !hasExcludedTerms && hasKeyword;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞ –∏ –ø–æ—Ä—Ç–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        function extractDomainAndPortFromConfig(config) {
            // –ü–∞—Ç—Ç–µ—Ä–Ω 1: @domain.com:port –∏–ª–∏ @ip:port
            const match1 = config.match(/@([a-zA-Z0-9.-]+):(\d+)/);
            if (match1 && match1[1] && match1[2]) {
                return { domain: match1[1], port: parseInt(match1[2]) };
            }
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω 2: @domain.com (–±–µ–∑ –ø–æ—Ä—Ç–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 443)
            const match2 = config.match(/@([a-zA-Z0-9.-]+)(?:[?/#]|$)/);
            if (match2 && match2[1]) {
                return { domain: match2[1], port: 443 };
            }
            
            return null;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS —á–µ—Ä–µ–∑ Cloudflare DNS-over-HTTPS
        async function checkDNS(domain) {
            if (!domain) return { success: false, error: '–ù–µ—Ç –¥–æ–º–µ–Ω–∞' };
            
            try {
                const cleanDomain = domain.replace(/[^a-zA-Z0-9.-]/g, '');
                
                const response = await fetch(`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(cleanDomain)}&type=A`, {
                    headers: { 'Accept': 'application/dns-json' },
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    return { success: false, error: `HTTP ${response.status}` };
                }
                
                const data = await response.json();
                
                if (data.Answer && data.Answer.length > 0) {
                    const hasValidIP = data.Answer.some(answer => {
                        const ip = answer.data;
                        return ip && (ip.match(/^\d+\.\d+\.\d+\.\d+$/) || ip.includes(':'));
                    });
                    
                    return { 
                        success: hasValidIP, 
                        ips: data.Answer.map(a => a.data).join(', '),
                        ttl: data.Answer[0]?.TTL || 0
                    };
                }
                
                return { success: false, error: '–ù–µ—Ç DNS –∑–∞–ø–∏—Å–µ–π' };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        async function checkWebSocket(domain, port) {
            if (!domain || !port) return { success: false, error: '–ù–µ—Ç –¥–æ–º–µ–Ω–∞ –∏–ª–∏ –ø–æ—Ä—Ç–∞' };
            
            return new Promise((resolve) => {
                const protocol = port === 443 || port === 8443 ? 'wss' : 'ws';
                const url = `${protocol}://${domain}:${port}`;
                
                const timeout = setTimeout(() => {
                    ws.close();
                    resolve({ success: false, error: '–¢–∞–π–º–∞—É—Ç 3—Å' });
                }, 3000);
                
                const ws = new WebSocket(url);
                
                ws.onopen = () => {
                    clearTimeout(timeout);
                    ws.close();
                    resolve({ success: true, protocol: protocol });
                };
                
                ws.onerror = () => {
                    clearTimeout(timeout);
                    resolve({ success: false, error: '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è' });
                };
                
                ws.onclose = () => {
                    clearTimeout(timeout);
                };
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ –Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        async function checkConfigHealth(config, isGuaranteed = false, isAI = false) {
            const domainInfo = extractDomainAndPortFromConfig(config);
            
            if (!domainInfo) {
                return {
                    config: config,
                    dns: { success: false, error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–æ–º–µ–Ω' },
                    ws: { success: false, error: '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–æ–º–µ–Ω' },
                    healthScore: 0,
                    status: 'unknown',
                    isGuaranteed: isGuaranteed,
                    isAI: isAI
                };
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º DNS
            const dnsResult = await checkDNS(domainInfo.domain);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º WebSocket (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ DNS —É—Å–ø–µ—à–µ–Ω)
            let wsResult = { success: false, error: 'DNS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç' };
            if (dnsResult.success) {
                wsResult = await checkWebSocket(domainInfo.domain, domainInfo.port);
            }
            
            // –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
            let healthScore = 0;
            let status = 'unknown';
            
            if (wsResult.success) {
                healthScore = 3;
                status = 'ws';
            } else if (dnsResult.success) {
                healthScore = 2;
                status = 'dns';
            } else {
                healthScore = (isGuaranteed || isAI) ? 1 : 0; // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ AI-–∫–æ–Ω—Ñ–∏–≥–∏ –ø–æ–ª—É—á–∞—é—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–ª
                status = 'dead';
            }
            
            return {
                config: config,
                domain: domainInfo.domain,
                port: domainInfo.port,
                dns: dnsResult,
                ws: wsResult,
                healthScore: healthScore,
                status: status,
                isGuaranteed: isGuaranteed,
                isAI: isAI
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
        async function fetchGuaranteedConfigs(keyword) {
            updateStatus('‚≠ê –ó–∞–≥—Ä—É–∑–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫...', 10);
            
            try {
                const response = await fetch(GUARANTEED_SUBSCRIPTION, { 
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                }
                
                const text = await response.text();
                const lines = text.split('\n');
                
                let configs = [];
                for (const line of lines) {
                    if (line.trim() && isValidConfig(line, keyword)) {
                        configs.push(line.trim());
                    }
                }
                
                updateStatus('‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', `–ù–∞–π–¥–µ–Ω–æ ${configs.length} –∫–æ–Ω—Ñ–∏–≥–æ–≤`, 20);
                return configs;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:', error);
                updateStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö', '–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏', 20);
                return [];
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        async function fetchConfigsFromSource(url, keyword, sourceIndex, totalSources) {
            try {
                const progress = 20 + Math.round((sourceIndex / totalSources) * 30);
                updateStatus(
                    '‚è≥ –ü–æ–∏—Å–∫ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö', 
                    `–ò—Å—Ç–æ—á–Ω–∏–∫ ${sourceIndex+1} –∏–∑ ${totalSources}`, 
                    progress
                );
                
                const response = await fetch(url, { 
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const text = await response.text();
                const lines = text.split('\n');
                
                let sourceConfigs = [];
                let count = 0;
                const maxConfigs = fastModeCheckbox.checked ? 5 : 1000;
                
                for (const line of lines) {
                    if (count >= maxConfigs) break;
                    
                    if (line.trim() && isValidConfig(line, keyword)) {
                        sourceConfigs.push(line.trim());
                        count++;
                    }
                }
                
                return sourceConfigs;
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ ${url}:`, error);
                return [];
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        function removeDuplicates(configs) {
            const seen = new Set();
            const result = [];
            
            for (const config of configs) {
                const stripped = config.trim();
                if (stripped && !seen.has(stripped)) {
                    seen.add(stripped);
                    result.push(stripped);
                }
            }
            
            return result;
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (—Ç–µ–ø–µ—Ä—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π AI)
        async function searchConfigs() {
            if (isProcessing) return;
            
            isProcessing = true;
            startBtn.disabled = true;
            startBtn.innerHTML = '<div class="loading spinner"></div> –ò–¥–µ—Ç –ø–æ–∏—Å–∫...';
            
            const keyword = keywordInput.value.trim();
            const enableAISearch = enableAISearchCheckbox.checked;
            const checkConfigs = checkConfigsCheckbox.checked;
            const fastMode = fastModeCheckbox.checked;
            const prioritizeGuaranteed = prioritizeGuaranteedCheckbox.checked;
            
            foundConfigs = [];
            totalConfigs = 0;
            configsWithoutDuplicates = 0;
            
            updateStatus('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫...', '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤', 0);
            
            // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            configsContainer.innerHTML = '';
            resultsPanel.style.display = 'none';
            
            let allConfigs = [];
            let aiConfigs = [];
            
            // –†–µ–∂–∏–º AI-–ø–æ–∏—Å–∫–∞
            if (enableAISearch) {
                try {
                    // 1. –°–æ–±–∏—Ä–∞–µ–º —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è AI
                    updateStatus('üì• –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è AI', '–°–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...', 10);
                    const rawConfigsText = await fetchRawConfigsFromAllSources();
                    
                    // 2. –ó–∞–ø—É—Å–∫–∞–µ–º AI-–ø–æ–∏—Å–∫
                    aiConfigs = await searchConfigsWithAI(keyword, rawConfigsText);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º AI-–∫–æ–Ω—Ñ–∏–≥–∏
                    allConfigs.push(...aiConfigs);
                    
                    updateStatus('‚úÖ AI –∫–æ–Ω—Ñ–∏–≥–∏ –ø–æ–ª—É—á–µ–Ω—ã', `AI –Ω–∞—à—ë–ª ${aiConfigs.length} –∫–æ–Ω—Ñ–∏–≥–æ–≤`, 70);
                    
                } catch (error) {
                    console.error('AI-–ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è:', error);
                    updateStatus('‚ö†Ô∏è AI-–ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è', '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫...', 30);
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –æ–±—ã—á–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
                }
            }
            
            // –û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ (–µ—Å–ª–∏ AI –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∏–ª–∏ –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)
            if (!enableAISearch || aiConfigs.length === 0) {
                // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –ü–ï–†–í–´–ú–ò
                const guaranteedConfigs = await fetchGuaranteedConfigs(keyword);
                allConfigs.push(...guaranteedConfigs);
                
                // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ –∏–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
                const subscriptions = getAllSubscriptions(prioritizeGuaranteed);
                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π), –µ—Å–ª–∏ –æ–Ω —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
                const additionalSources = subscriptions.slice(1);
                
                for (let i = 0; i < additionalSources.length; i++) {
                    const sourceConfigs = await fetchConfigsFromSource(additionalSources[i], keyword, i, additionalSources.length);
                    allConfigs.push(...sourceConfigs);
                    totalConfigs = allConfigs.length;
                    
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // 3. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                updateStatus('üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', '–£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤...', 60);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            const uniqueConfigs = removeDuplicates(allConfigs);
            
            // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
            let checkedConfigs = [];
            if (checkConfigs && uniqueConfigs.length > 0) {
                updateStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏', `–ü—Ä–æ–≤–µ—Ä–∫–∞ ${uniqueConfigs.length} –∫–æ–Ω—Ñ–∏–≥–æ–≤...`, enableAISearch ? 75 : 70);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤ –≤ –±—ã—Å—Ç—Ä–æ–º —Ä–µ–∂–∏–º–µ
                const configsToCheck = fastMode ? uniqueConfigs.slice(0, 20) : uniqueConfigs;
                
                for (let i = 0; i < configsToCheck.length; i++) {
                    const config = configsToCheck[i];
                    const progress = (enableAISearch ? 75 : 70) + Math.round((i / configsToCheck.length) * 25);
                    
                    updateStatus(
                        'üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤', 
                        `–ü—Ä–æ–≤–µ—Ä–∫–∞ ${i+1} –∏–∑ ${configsToCheck.length}`, 
                        progress
                    );
                    
                    try {
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–æ–Ω—Ñ–∏–≥–∞
                        const isGuaranteed = config.includes('vless') && config.includes(GUARANTEED_SUBSCRIPTION.substring(0, 30)); // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                        const isAI = aiConfigs.includes(config);
                        
                        const healthInfo = await checkConfigHealth(config, isGuaranteed, isAI);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥–∏ —Å DNS –∏–ª–∏ WebSocket –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é
                        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ AI-–∫–æ–Ω—Ñ–∏–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ —Å –Ω–∏–∑–∫–∏–º healthScore
                        if (healthInfo.healthScore >= 2 || isGuaranteed || isAI) {
                            checkedConfigs.push(healthInfo);
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞:`, error);
                    }
                    
                    // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
                    await new Promise(resolve => setTimeout(resolve, 400));
                }
                
                configsWithoutDuplicates = checkedConfigs.length;
            } else {
                // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞, –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏
                checkedConfigs = uniqueConfigs.map(config => {
                    const isGuaranteed = config.includes('vless') && config.includes(GUARANTEED_SUBSCRIPTION.substring(0, 30));
                    const isAI = aiConfigs.includes(config);
                    
                    return {
                        config: config,
                        domain: extractDomainAndPortFromConfig(config)?.domain || 'unknown',
                        healthScore: 0,
                        status: 'unchecked',
                        dns: { success: null },
                        ws: { success: null },
                        isGuaranteed: isGuaranteed,
                        isAI: isAI
                    };
                });
                configsWithoutDuplicates = checkedConfigs.length;
            }
            
            // 5. –°–æ—Ä—Ç–∏—Ä—É–µ–º: –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, AI-–∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ª—É—á—à–∏–µ –ø–æ healthScore - –ø–µ—Ä–≤—ã–µ
            checkedConfigs.sort((a, b) => {
                // –°–Ω–∞—á–∞–ª–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
                if (a.isGuaranteed && !b.isGuaranteed) return -1;
                if (!a.isGuaranteed && b.isGuaranteed) return 1;
                
                // –ó–∞—Ç–µ–º AI-–∫–æ–Ω—Ñ–∏–≥–∏
                if (a.isAI && !b.isAI) return -1;
                if (!a.isAI && b.isAI) return 1;
                
                // –ó–∞—Ç–µ–º –ø–æ healthScore
                return b.healthScore - a.healthScore;
            });
            
            // 6. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            displayResults(checkedConfigs);
            
            // –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
            const aiCount = checkedConfigs.filter(c => c.isAI).length;
            const guaranteedCount = checkedConfigs.filter(c => c.isGuaranteed).length;
            
            let finalMessage = '‚úÖ –ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!';
            let finalDetails = `–ù–∞–π–¥–µ–Ω–æ ${configsWithoutDuplicates} –∫–æ–Ω—Ñ–∏–≥–æ–≤`;
            
            if (guaranteedCount > 0) {
                finalDetails += ` (${guaranteedCount} –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)`;
            }
            if (aiCount > 0) {
                finalDetails += ` (${aiCount} AI-–Ω–∞–π–¥–µ–Ω–Ω—ã—Ö)`;
            }
            
            updateStatus(finalMessage, finalDetails, 100);
            
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤';
            isProcessing = false;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayResults(checkedConfigs) {
            configCount.textContent = `${checkedConfigs.length} –∫–æ–Ω—Ñ–∏–≥–æ–≤`;
            configsContainer.innerHTML = '';
            
            if (checkedConfigs.length === 0) {
                configsContainer.innerHTML = '<div class="config-item">–ö–æ–Ω—Ñ–∏–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å AI-–ø–æ–∏—Å–∫.</div>';
            } else {
                checkedConfigs.forEach((healthInfo, index) => {
                    const configElement = document.createElement('div');
                    configElement.className = 'config-item';
                    
                    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const decodedDisplay = decodeURLComponent(healthInfo.config);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                    if (healthInfo.isGuaranteed) {
                        const statusElement = document.createElement('span');
                        statusElement.className = 'config-status status-guaranteed';
                        statusElement.textContent = '‚≠ê –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–´–ô';
                        statusElement.title = '–ò–∑ –≤–∞—à–µ–π –Ω–∞–¥–µ–∂–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏';
                        configElement.appendChild(statusElement);
                    } else if (healthInfo.isAI) {
                        const statusElement = document.createElement('span');
                        statusElement.className = 'config-status status-ai';
                        statusElement.textContent = 'ü§ñ AI-–ù–ê–ô–î–ï–ù–ù–´–ô';
                        statusElement.title = '–ù–∞–π–¥–µ–Ω —Å –ø–æ–º–æ—â—å—é AI-–ø–æ–∏—Å–∫–∞';
                        configElement.appendChild(statusElement);
                    } else if (healthInfo.status === 'ws') {
                        const statusElement = document.createElement('span');
                        statusElement.className = 'config-status status-ws';
                        statusElement.textContent = '‚úì WebSocket';
                        statusElement.title = 'WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç';
                        configElement.appendChild(statusElement);
                    } else if (healthInfo.status === 'dns') {
                        const statusElement = document.createElement('span');
                        statusElement.className = 'config-status status-dns';
                        statusElement.textContent = '‚úì DNS';
                        statusElement.title = 'DNS —Ä–∞–±–æ—Ç–∞–µ—Ç, WebSocket –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç';
                        configElement.appendChild(statusElement);
                    }
                    
                    // –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    const content = document.createElement('div');
                    
                    let statusText = '';
                    if (healthInfo.isGuaranteed) {
                        statusText = `<span style="color:#daaa0f">‚≠ê –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥</span>`;
                    } else if (healthInfo.isAI) {
                        statusText = `<span style="color:#bc54ff">ü§ñ –ù–∞–π–¥–µ–Ω AI</span>`;
                    } else if (healthInfo.status === 'ws') {
                        statusText = `<span style="color:#3fb950">‚úì WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç</span>`;
                    } else if (healthInfo.status === 'dns') {
                        statusText = `<span style="color:#58a6ff">‚úì DNS —Ä–∞–±–æ—Ç–∞–µ—Ç</span>`;
                    } else if (healthInfo.status === 'unchecked') {
                        statusText = `<span style="color:#8b949e">? –ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω</span>`;
                    } else {
                        statusText = `<span style="color:#f85149">‚úó –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º</span>`;
                    }
                    
                    content.innerHTML = `
                        <div><strong>${index + 1}. ${decodedDisplay.substring(0, 100)}${decodedDisplay.length > 100 ? '...' : ''}</strong></div>
                        <div style="font-size:0.8em;margin-top:5px;color:#8b949e;">
                            ${statusText}
                            ${healthInfo.domain ? ` ‚Ä¢ ${healthInfo.domain}:${healthInfo.port || '?'}` : ''}
                            ${healthInfo.dns.ips ? ` ‚Ä¢ IP: ${healthInfo.dns.ips}` : ''}
                        </div>
                    `;
                    configElement.appendChild(content);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
                    configElement.dataset.original = healthInfo.config;
                    
                    configsContainer.appendChild(configElement);
                });
            }
            
            resultsPanel.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
        function downloadConfigs() {
            const configElements = document.querySelectorAll('.config-item[data-original]');
            if (configElements.length === 0) {
                alert('–ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            const originalConfigs = [];
            configElements.forEach(el => {
                if (el.dataset.original) {
                    originalConfigs.push(el.dataset.original);
                }
            });
            
            const outputPath = outputPathInput.value.trim();
            let fileName = 'UWB_script_configs.txt';
            if (outputPath) {
                const pathParts = outputPath.split('/');
                if (pathParts.length > 0) {
                    const lastPart = pathParts[pathParts.length - 1];
                    if (lastPart.includes('.txt')) {
                        fileName = lastPart;
                    } else {
                        fileName = `${lastPart}/UWB_script_configs.txt`;
                    }
                }
            }
            
            const configText = originalConfigs.join('\n');
            const blob = new Blob([configText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateStatus('‚úÖ –ö–æ–Ω—Ñ–∏–≥–∏ —Å–∫–∞—á–∞–Ω—ã!', `–§–∞–π–ª "${fileName}" —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 100);
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞
        function resetForm() {
            if (isProcessing) return;
            
            outputPathInput.value = '';
            keywordInput.value = '';
            enableAISearchCheckbox.checked = false; // AI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω
            foundConfigs = [];
            totalConfigs = 0;
            configsWithoutDuplicates = 0;
            
            configsContainer.innerHTML = '';
            resultsPanel.style.display = 'none';
            
            updateStatus('–ì–æ—Ç–æ–≤ –∫ –ø–æ–∏—Å–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤...', '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤" –¥–ª—è –∑–∞–ø—É—Å–∫–∞', 0);
            
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ –∫–æ–Ω—Ñ–∏–≥–æ–≤';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        startBtn.addEventListener('click', searchConfigs);
        resetBtn.addEventListener('click', resetForm);
        downloadBtn.addEventListener('click', downloadConfigs);

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ AI-–ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
        keywordInput.addEventListener('input', function() {
            if (this.value.trim() === '' && enableAISearchCheckbox.checked) {
                enableAISearchCheckbox.checked = false;
                updateStatus('‚ö†Ô∏è AI-–ø–æ–∏—Å–∫ –æ—Ç–∫–ª—é—á–µ–Ω', '–î–ª—è AI-–ø–æ–∏—Å–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ', 0);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateStatus('–ì–æ—Ç–æ–≤ –∫ –ø–æ–∏—Å–∫—É –∫–æ–Ω—Ñ–∏–≥–æ–≤...', `AI-–ø–æ–∏—Å–∫ –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í–∫–ª—é—á–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.`, 0);
    </script>
</body>
</html>